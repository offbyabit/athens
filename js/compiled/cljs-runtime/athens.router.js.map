{"version":3,"sources":["athens/router.cljs"],"mappings":";;;;;;;;AAWA,AAAAA,AAAA;AAAAC,AAEE,AAAKE;AAAL,AACE,AAAA,AAAgBA;;AAHpB,AAAA,AAAAH,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;AAMD,AAAA,AAACE,AAEC,AAAAC,AAAKO;AAAL,AAAA,AAAAN,AAAAD;AAAAE,AAAA,AAAAC,AAAAF;AAAAG,AAAA,AAAAC,AAAAH;AAAAA,AAAA,AAAAI,AAAAJ;AAAAE,AAAQG;AAARL,AAAYM;AAAZ,AAAA,AAAA,AACcA;;AAGhB,AAAA,AAACC,AAEC,AAAAC,AAAKZ;AAAL,AAAA,AAAAa,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAASJ;AAAT,AAAAK,AAAAD,AAAA,AAAA,AAAWE;AAAX,AACE,AAAMC,AAAY,AAAA,AAAgBhB;AAC5BiB,AAAY,AAACC,AAAsB,AAAA,AAAcF,AAAWD;AAC5DI,AAAK,AAAAC,AAAA,AAAA,AAAA,AAAA,AAA8B,AAAA,AAAA,AAAA,AAAIL;AAAlC,AAAA,AAAAK,AAAAA,AAACC,AAAAA,AAAAA;;AAFZ,AAGE,AAAM,AAASC,AAAa,AAAAC,AAAI,AAAA,AAAA,AAAAC,AAAcL;AAAlB,AAAA,AAAAI;AAAAA;;AAAA;;;;AAC5B,AAAA,AAACE,AAAMzB,AAAkB,AAAA,AAACyB,AAAMV,AAAuBE;;AAI7D,AAAAS,AAAA;AAAAC,AAEE,AAAA,AAAAE,AAAA,AAAYnB;AAAZ,AAAA,AAAAoB,AAAA;AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA;;AAAA,AAAAC,AAAAF;AAAAG,AAAA,AAAA,AAAAD,AAAAF,AACYO;AADZJ,AACkBK;AADlB,AAAA,AAAAJ,AAAA,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAA;;AAAAA;AAAA,AAAAD,AAAAF;AAAAG,AACkCvB;AADlC,AAAA,AAAAwB,AAAA,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAA;;AAAAA;;AAAA,AAAA,AAAAC,AAAA,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAA;;AAAAA;AAAA,AAAAE,AAAAC;AAAA,AAAA,AAAAD;AAAA,AAAYzB;AAAZ,AACW,AAAC2B,AAAMC,AAAgB5B;;AAHpC,AAAA,AAAAgB,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;AAOD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKW;AAQL,AAAKC,AACH,AAAA,AAAA,AAAA,AAAA,AAACC,AACCF,AACkBG;AAGtB,AAAA,AAAMC,AACH5B;AADH,AAEE,AAAMA;AAAN,AACE,AAAA6B,AAAA,AAAA,AAAsB7B;AAAtB,AAAA,AAAA6B,AAAAA,AAACC,AAAAA,AAAAA;;AADH;;;AAIF,AAAA,AAAMC,AACHC;AADH,AAEE,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAgCD;AAAhC,AAAA,AAAAC,AAAAA,AAACH,AAAAA,AAAAA;;AAGH,AAAA,AAAMI,AACHC,AAAKC;AADR,AAEE,AAAAC,AAAA,AAAA,AAA8BF,AAAKC;AAAnC,AAAA,AAAAC,AAAAA,AAACP,AAAAA,AAAAA;;AAGH,AAAA,AAAMQ;AAAN,AAEE,AAAA,AAACC;;AACD,AAAA,AAAA,AAAA,AAACC,AACCf,AACAG","names":["G__53446","G__53447","re-frame.core/reg-sub","db","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$2","p__53448","vec__53449","seq__53450","cljs.core/seq","first__53451","cljs.core/first","cljs.core/next","_","route","re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","p__53452","vec__53453","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","new-match","old-match","controllers","reitit.frontend.controllers/apply-controllers","node","G__53456","re-frame.core/subscribe","js/document","or__4185__auto__","cljs.core/deref","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","G__53457","G__53458","re-frame.core/reg-fx","day8.re-frame.tracing/is-trace-enabled?","+debux-dbg-opts+","debux.common.util/send-form!","opts__47114__auto__","result__47115__auto__","debux.common.util/send-trace!","e","e53459","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","reitit.frontend.easy/push-state","athens.router/routes","athens.router/router","reitit.frontend.router.cljs$core$IFn$_invoke$arity$2","reitit.coercion.spec/coercion","athens.router/on-navigate","G__53460","re-frame.core/dispatch","athens.router/navigate-page","uid","G__53461","athens.router/toggle-open","dbid","open","G__53462","athens.router/init-routes!","cljs.core.prn.cljs$core$IFn$_invoke$arity$variadic","reitit.frontend.easy/start!"],"sourcesContent":["(ns athens.router\n  (:require\n    #_[athens.views :as views]\n    [day8.re-frame.tracing :refer-macros [fn-traced]]\n    [re-frame.core :refer [subscribe dispatch reg-sub reg-event-db reg-event-fx reg-fx]]\n    [reitit.coercion.spec :as rss]\n    [reitit.frontend :as rfe]\n    [reitit.frontend.controllers :as rfc]\n    [reitit.frontend.easy :as rfee]))\n\n;; subs\n(reg-sub\n  :current-route\n  (fn [db]\n    (:current-route db)))\n\n;; events\n(reg-event-fx\n  :navigate\n  (fn [_ [_ & route]]\n    {:navigate! route}))\n\n\n(reg-event-db\n  :navigated\n  (fn [db [_ new-match]]\n    (let [old-match   (:current-route db)\n          controllers (rfc/apply-controllers (:controllers old-match) new-match)\n          node (subscribe [:node [:block/uid (-> new-match :path-params :id)]])] ;; TODO make the page title query work when zoomed in on a block\n      (set! (.-title js/document) (or (:node/title @node) \"Athens Research\")) ;; TODO make this side effect explicit\n      (assoc db :current-route (assoc new-match :controllers controllers)))))\n\n;; effects\n\n(reg-fx\n  :navigate!\n  (fn-traced [route]\n             (apply rfee/push-state route)))\n\n;; router definition\n\n(def routes\n  [\"/\"\n   [\"\"      {:name :home}]\n   [\"about\" {:name :about}]\n   [\"pages\" {:name :pages}]\n   [\"page/:id\" {:name :page}]])\n\n\n(def router\n  (rfe/router\n    routes\n    {:data {:coercion rss/coercion}}))\n\n\n(defn on-navigate\n  [new-match]\n  (when new-match\n    (dispatch [:navigated new-match])))\n\n\n(defn navigate-page\n  [uid]\n  (dispatch [:navigate :page {:id uid}]))\n\n\n(defn toggle-open\n  [dbid open]\n  (dispatch [:block/toggle-open dbid open]))\n\n\n(defn init-routes!\n  []\n  (prn \"Initializing routes\")\n  (rfee/start!\n    router\n    on-navigate\n    {:use-fragment true}))\n"]}